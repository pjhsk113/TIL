# [대규모 시스템 설계] 응답시간 개선하기

앞서 웹 계층과 데이터 계층의 규모에 따른 시스템 설계를 살펴봤으니, 응답시간을 개선하는 방법에 대해 알아보자.

응답시간은 캐시와 콘텐츠 전송 네트워크(CDN)를 이용해 개선할 수 있다.

## 캐시란?

캐시는 비싼 연산이나 자주 조회되는 데이터를 메모리에 올려두는 임시 저장소다.
접근 시간이 오래걸리는 반복 요청이나 값을 다시 계산하는 비용을 줄이고 싶은 경우 유용하다.

웹 서비스는 데이터베이스 호출 빈도에 따라 성능이 크게 좌우되기 때문에 캐시를 잘 활용하면 성능을 유의미하게 올릴 수 있다.

## 캐시 계층

캐시 계층은 데이터가 잠시 보관되는 곳으로 데이터베이스에 접근하는 것보다 훨씬 빠르다.
별도의 캐시 계층을 두면 이미 캐시에 데이터가 보관되어 있다면 성능이 개선될 뿐 아니라 데이터베이스의 부하도 줄일 수 있다.

캐시 계층의 역할은 다음과 같다.

캐시에 원하는 데이터가 있는 경우 DB에 쿼리를 날리지 않고 서버로 데이터를 반환한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c77ed3b9-d9e8-4f3b-87bc-66b2fce3bcd6/Untitled.png)

없는 경우에는 DB에 쿼리를 날려 데이터를 찾아 캐시에 저장한 다음 데이터를 서버로 반환한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e4ecb0df-ae60-4e91-b9ab-d7ab8747f71e/Untitled.png)

이러한 캐시 전략을 **주도형 캐시 전략(read-through)**이라고 부른다.
이외에도 cache-aside, write-through, write-behind, refresh-ahead 등 다양한 캐시 전략들이 존재한다.
캐시할 데이터 종류, 크기, 액세스 패턴에 맞는 전략을 적절히 선택하면 된다.

## 캐시 사용 시 고려사항

캐시를 사용할 때는 아래 사항들을 고려해야 한다.

- 캐시는 어떤 상황에 바람직한가?
  - 데이터 갱신이 자주 일어나지 않지만, 참조가 빈번하게 일어난다면 캐시로 사용이 적합하다.
- 어떤 데이터를 캐시에 두어야 하는가?
  - 영속적으로 보관할 데이터는 캐시에 적합하지 않다. 캐시 서버가 재시작되면 데이터는 모두 사라지기 때문이다.
- 캐시에 보관 데이터는 어떻게 만료되는가?
  - 적절한 정책을 마련해두어야 한다. 만료 기간이 너무 짧으면 잦은 데이터베이스 조회가 일어날 것이고, 반대로 너무 길다면 원본 데이터와의 차이가 생길 수 있다.
- 일관성은 어떻게 유지할 것인가?
- 장애에는 어떻게 대처할 것인가?