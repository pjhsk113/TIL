# 4장. 아키텍처

**MySQL 서버**는 크게 머리 역할을 담당하는 **MySQL 엔진**과 손발 역할을 담당하는 **스토리지 엔진**으로 구성된다. 기본으로 제공되는 스토리지 엔진에는 InnoDB와 MyISAM 등이 있다.

## MySQL의 구조

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9fba66c6-5ab7-4a7a-a9d4-f8d2ddbfb2f5/Untitled.png)

### MySQL 엔진

MySQL 엔진은 다음과 같은 구성요소가 중심을 이룬다.

- 접속 및 쿼리 요청을 처리하는 커넥션 핸들러
- SQL 파서
- 전처리기
- 옵티마이저

또한, ANSI SQL 문법을 지원하기 때문에 다른 DBMS와 호환되어 실행될 수 있다.
MySQL 엔진은 SQL 문장을 분석하거나 최적화하는 등 DBMS의 두뇌 역할을 맡고 있다고 보면된다. 우리의 머리가 하나인 것처럼 MySQL 서버에서도 MySQL 엔진은 하나만 존재한다.

### 스토리지 엔진

스토리지 엔진은 실제 데이터를 디스크 스토리지에 저장하거나 읽어오는 부분을 담당한다.
MySQL 엔진과 다르게 스토리지 엔진은 여러 개를 동시에 사용할 수 있다.

### 핸들러 API

MySQL 엔진의 쿼리 실행기에서 스토리지 엔진에 쓰기 또는 읽기를 요청하는데, 이를 핸들러 요청이라고 한다. 이때 사용되는 API를 핸들러 API라고 부른다. InnoDB 스토리지 엔진 또한 핸들러 API를 이용해 MySQL 엔진과 데이터를 주고 받는다.

## MySQL 스레딩 구조

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4155c68d-ea2f-4ce6-9363-ec12cb5c96e9/Untitled.png)

MySQL 서버는 프로세스 기반이 아닌 스레드 기반으로 동작하며, 크게 포그라운드 스레드와 백그라운드 스레드로 구분할 수 있다.

### 포그라운드 스레드

포그라운드 스레드는 MySQL 서버에 접속된 클라이언트 수만큼 존재하며, 주로 사용자가 요청하는 쿼리 문장을 처리한다. 그 후 사용자가 작업을 마치고 커넥션을 종료하면 해당 스레드는 다시 스레드 캐시로 되돌아간다. 만약 스레드 캐시에 이미 일정 개수 이상의 스레드가 대기중이라면 해당 스레드를 종료시켜 일정 개수의 스레드만 스래드 캐시에 존재하게 한다.

포그라운드 스레드는 데이터를 MySQL의 데이터 버퍼나 캐시로부터 가져오며, 버퍼나 캐시에 없는 경우 직접 디스크의 데이터나 인덱스 파일로부터 데이터를 읽어와 작업을 처리한다.

### 백그라운드 스레드