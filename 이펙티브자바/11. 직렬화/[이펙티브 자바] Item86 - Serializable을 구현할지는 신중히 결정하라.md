# [이펙티브 자바] Item86 - Serializable을 구현할지는 신중히 결정하라

클래스 선언에 implements Serializable만 붙이면 어떤 클래스의 인스턴스던 직렬화 할 수 있다. 너무 쉽게 적용할 수 있기 때문에 특별히 신경 쓸게 없다고 생각할 수 있지만, 실제로는 훨씬 복잡하고 신경써야 할 부분이 많다.

# Serializable 구현 시 발생하는 문제점

## 1. 릴리스 후 수정이 어려워진다.

Serializable을 구현하면 릴리스 한 뒤에는 수정하기 어려워진다. Serializable을 구현한 클래스는 하나의 공개 API가 되기 때문인데, 만약 이 클래스가 널리 퍼진다면 구현한 직렬화 형태도 영원히 지원해야한다.

자바의 기본 직렬화 방식을 사용하면 직렬화 형태는 적용 당시 클래스의 내부 구현 방식에 종속된다. 달리 말하면, 클래스의 private와 package-private 인스턴스 필드마저 API로 공개되어 캡슐화가 깨진다.

뒤늦게 내부 구현을 수정하면 직렬화 형태가 달라져 직렬화-역직렬화에 실패할 수 있다. 

대표적으로 serialVersionUID를 예로 들 수 있다. serialVersionUID는 내부에 직접 명시하지 않는 경우 런타임시 자동으로 생성된다. 자동 생성될 때는 클래스의 이름, 구현한 인터페이스 등이 고려되기 때문에 이들 중 하나라도 변경되면 UID 값도 달라진다. 따라서 쉽게 호환성이 깨지고 런타임에 InvalidClassException이 발생한다.

원래의 직렬화 형태를 유지하면서 내부 구현을 수정할 수도 있지만, 이는 어렵고 소스코드도 지저분해 진다. 만약 우리가 직렬화 가능 클래스를 만든다면 고품질의 직렬화 형태도 함께 설계해야 한다.

## 2. 버그와 보안 취약점이 생길 위험이 높아진다.

앞선 아이템(item85)에서 설명했듯, 기본 역직렬화는 **숨은 생성자**다. 전면에 드러나지 않는 숨은 생성자이기 때문에 불변식 깨짐과 허가되지 않은 접근에 쉽게 노출되어 버그와 보안 취약점이 생길 위험이 높아진다.

## 3. 신버전 릴리스 시 테스트 요소가 많아진다.